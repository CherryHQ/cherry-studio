# Knowledge Service

## cleanupStoreCache 的必要性

如果移除 `cleanupStoreCache`（仅删除文件而不清理缓存中的 store），在删除/重建知识库时可能出现以下问题：

- 删除失败：libsql 客户端仍持有文件句柄，导致 `rm` 失败或留下残留文件。
- 旧连接继续工作：缓存中的旧 store 仍被复用，继续指向已删除或即将被重建的库。
- 重建后读到旧状态：新库同名但旧连接未释放，查询/写入仍走旧连接。
- 资源泄漏：长期运行进程里，未清理的 store 累积占用内存/句柄。

> 小结：`cleanupStoreCache` 是删除流程中的内存清理步骤，用于避免“文件已删但连接仍占用”的常见问题。
