# File Processing Service - æ¦‚å¿µè®¾è®¡æ–‡æ¡£

## èƒŒæ™¯

å½“å‰ç³»ç»Ÿä¸­ OCR ä¸ Preprocess åˆ†åˆ«æœåŠ¡ä¸åŒåœºæ™¯ï¼š

- **OCR**ï¼šä»¥"å›¾ç‰‡æ–‡å­—è¯†åˆ«"ä¸ºä¸»ï¼Œæä¾›å¤šç§å¼•æ“èƒ½åŠ›ï¼Œæ›´å¤šèšç„¦é€šç”¨å›¾åƒ OCR
- **Preprocess**ï¼šä»¥"çŸ¥è¯†åº“æ–‡æ¡£é¢„å¤„ç†"ä¸ºä¸»ï¼Œä¸»è¦å¤„ç† PDFï¼ˆå«æ‰«æä»¶ï¼‰ï¼Œå¹¶å°†ç»“æœè½¬åŒ–ä¸ºå¯æ£€ç´¢çš„æ–‡æœ¬/Markdown

éšç€åŠŸèƒ½æ¼”è¿›ï¼Œä¸¤è€…éƒ½å±äº"å¯¹æ–‡ä»¶è¿›è¡Œå†…å®¹æå–ä¸è§£æ"çš„èŒƒç•´ï¼Œå­˜åœ¨èƒ½åŠ›é‡å ä¸è¾¹ç•Œæ¨¡ç³Šã€‚

## ç›®æ ‡

1. ç»Ÿä¸€ OCR ä¸ Preprocess çš„æ¦‚å¿µè¾¹ç•Œï¼Œå½¢æˆ"æ–‡ä»¶å¤„ç†èƒ½åŠ›"çš„ç»Ÿä¸€è¡¨è¾¾ä¸èƒ½åŠ›å±‚
2. å°† Preprocess ä»çŸ¥è¯†åº“ä¸šåŠ¡ä¸­æŠ½ç¦»ï¼Œæˆä¸ºå¯è¢«å„ä¸šåŠ¡è°ƒç”¨çš„æœåŠ¡
3. ä¸ºæœªæ¥æ‰©å±•ï¼ˆå¤šä¸šåŠ¡å¤ç”¨ã€æ›´å¤šæ–‡ä»¶ç±»å‹ã€æ›´å¤šå¤„ç†èƒ½åŠ›ï¼‰å»ºç«‹æ¸…æ™°è¾¹ç•Œ

---

## æ ¸å¿ƒè®¾è®¡

### è®¾è®¡åŸåˆ™

- **ä¸æŒ‰ OCR/Preprocess åˆ†ç±»**ï¼šç°ä»£ LLM-based æœåŠ¡ï¼ˆå¦‚ DeepSeek-OCRï¼‰å·²æ¨¡ç³Šè¾¹ç•Œ
- **æŒ‰èƒ½åŠ›ç»´åº¦æè¿°**ï¼šç”¨ Feature æè¿°"èƒ½åšä»€ä¹ˆ"ï¼Œç”¨ Input/Output æè¿°"å¤„ç†ä»€ä¹ˆ"
- **ç»Ÿä¸€æœåŠ¡å…¥å£**ï¼š`process(file, options)` â†’ `ProcessingResult`

---

## æ•°æ®ç»“æ„

é‡‡ç”¨ **Template + User Config** åˆ†ç¦»è®¾è®¡ï¼š
- **Template**ï¼ˆåªè¯»ï¼‰ï¼šå¤„ç†å™¨å…ƒæ•°æ®ï¼Œå®šä¹‰èƒ½åŠ›è¾¹ç•Œ
- **User Config**ï¼ˆPreference å­˜å‚¨ï¼‰ï¼šç”¨æˆ·ä¿®æ”¹çš„é…ç½®

### Template ç»“æ„ï¼š`FileProcessorTemplate`

| å­—æ®µ           | ç±»å‹                  | è¯´æ˜                           |
| -------------- | --------------------- | ------------------------------ |
| `id`           | string                | å”¯ä¸€æ ‡è¯†ï¼Œä¹Ÿç”¨äº i18n key      |
| `type`         | `'api' \| 'builtin'`  | æœåŠ¡ç±»å‹                       |
| `capabilities` | `FeatureCapability[]` | èƒ½åŠ›å®šä¹‰æ•°ç»„                   |

> **i18n**: å¤„ç†å™¨æ˜¾ç¤ºåç§°é€šè¿‡ `processor.${id}.name` è·å–ï¼ŒTemplate ä¸å­˜å‚¨ name å­—æ®µ

### èƒ½åŠ›ç»“æ„ï¼š`FeatureCapability`

å°†èƒ½åŠ›ï¼ˆFeatureï¼‰ä¸è¾“å…¥/è¾“å‡ºç±»å‹ç»‘å®šï¼Œæ”¯æŒ Feature çº§åˆ«çš„ API é…ç½®ï¼š

| å­—æ®µ               | ç±»å‹                                   | è¯´æ˜                              |
| ------------------ | -------------------------------------- | --------------------------------- |
| `feature`          | `'text_extraction' \| 'to_markdown'`   | èƒ½åŠ›ç±»å‹                          |
| `input`            | `'image' \| 'document'`                | è¾“å…¥ç±»å‹                          |
| `output`           | `'text' \| 'markdown'`                 | è¾“å‡ºç±»å‹                          |
| `supportedFormats` | `string[]?`                            | ç™½åå•ï¼šä»…æ”¯æŒè¿™äº›æ ¼å¼            |
| `excludedFormats`  | `string[]?`                            | é»‘åå•ï¼šé™¤è¿™äº›æ ¼å¼å¤–éƒ½æ”¯æŒ        |
| `defaultApiHost`   | `string?`                              | Feature çº§é»˜è®¤ API Host           |
| `defaultModelId`   | `string?`                              | Feature çº§é»˜è®¤ Model ID           |

### ç”¨æˆ·é…ç½®ç»“æ„ï¼š`FileProcessorOverride`

å­˜å‚¨åœ¨ Preference ç³»ç»Ÿä¸­ï¼Œä»…ä¿å­˜ç”¨æˆ·ä¿®æ”¹çš„å­—æ®µï¼š

Preference Key: `feature.file_processing.overrides`ï¼Œç±»å‹ä¸º `FileProcessorOverrides`ï¼ˆ`Record<string, FileProcessorOverride>`ï¼‰ã€‚

| å­—æ®µ             | ç±»å‹                    | è¯´æ˜                              |
| ---------------- | ----------------------- | --------------------------------- |
| `apiKey`         | `string?`                  | API Keyï¼ˆå¤„ç†å™¨çº§å…±äº«ï¼‰           |
| `featureConfigs` | `FeatureUserConfig[]?`     | Feature çº§é…ç½®                    |
| `options`        | `Record<string, unknown>?` | å¤„ç†å™¨ç‰¹å®šé…ç½®                    |

### Feature ç”¨æˆ·é…ç½®ï¼š`FeatureUserConfig`

å…è®¸ç”¨æˆ·å¯¹ç‰¹å®š Feature è¦†ç›– API Host å’Œ Model IDï¼š

| å­—æ®µ       | ç±»å‹                                   | è¯´æ˜                              |
| ---------- | -------------------------------------- | --------------------------------- |
| `feature`  | `'text_extraction' \| 'to_markdown'`   | èƒ½åŠ›ç±»å‹                          |
| `apiHost`  | `string?`                              | ç”¨æˆ·è¦†ç›–çš„ API Host               |
| `modelId`  | `string?`                              | ç”¨æˆ·è¦†ç›–çš„ Model ID               |

### æ ¼å¼è¿‡æ»¤è§„åˆ™

`FeatureCapability` ä¸­çš„ `supportedFormats` å’Œ `excludedFormats` ç”¨äºæ§åˆ¶æ ¼å¼æ”¯æŒï¼š

| æƒ…å†µ                     | è¡Œä¸º                                    |
| ------------------------ | --------------------------------------- |
| éƒ½ä¸æŒ‡å®š                 | æ”¯æŒè¯¥ input ç±»åˆ«çš„æ‰€æœ‰æ ¼å¼             |
| æŒ‡å®š `supportedFormats`  | ä»…æ”¯æŒåˆ—å‡ºçš„æ ¼å¼ï¼ˆç™½åå•æ¨¡å¼ï¼‰          |
| æŒ‡å®š `excludedFormats`   | æ”¯æŒé™¤åˆ—å‡ºæ ¼å¼å¤–çš„æ‰€æœ‰æ ¼å¼ï¼ˆé»‘åå•æ¨¡å¼ï¼‰|

---

## ç±»å‹å®šä¹‰

> **æ³¨æ„**ï¼šä½¿ç”¨ TypeScript å­—é¢é‡è”åˆç±»å‹è€Œé enumï¼Œä¿æŒä¸ä»£ç ä¸€è‡´

### Featureï¼ˆèƒ½åŠ›ï¼‰

```typescript
type FileProcessorFeature = 'text_extraction' | 'to_markdown'
```

| ç±»å‹              | è¯´æ˜                                    |
| ----------------- | --------------------------------------- |
| `text_extraction` | æ–‡å­—æå–ï¼ˆç»§æ‰¿ OCR åŠŸèƒ½ï¼‰               |
| `to_markdown`     | è½¬æ¢ä¸º Markdownï¼ˆç»§æ‰¿æ–‡æ¡£é¢„å¤„ç†åŠŸèƒ½ï¼‰   |

**è®¾è®¡è¯´æ˜**ï¼šç®€åŒ–ä¸ºä¸¤ä¸ªæ ¸å¿ƒèƒ½åŠ›ï¼Œä¸å†ç»†åˆ† `layout_analysis`ã€`table_detection`ã€`formula_detection`ã€`multimodal` ç­‰å…·ä½“å®ç°ç»†èŠ‚ã€‚è¿™äº›èƒ½åŠ›ç»†èŠ‚ç”±å…·ä½“ processor å†…éƒ¨å®ç°ã€‚

### Inputï¼ˆè¾“å…¥ç±»å‹ï¼‰

```typescript
type FileProcessorInput = 'image' | 'document'
```

| ç±»å‹       | è¯´æ˜ | åŒ…å«æ ¼å¼                          |
| ---------- | ---- | --------------------------------- |
| `image`    | å›¾ç‰‡ | jpg, png, webp, gif...            |
| `document` | æ–‡æ¡£ | pdf, docx, pptx, xlsx, md, txt... |

> **æœªæ¥æ‰©å±•**ï¼šå¯æ·»åŠ  `audio`ï¼ˆmp3, wav, m4a...ï¼‰ã€`video`ï¼ˆmp4, mov, webm...ï¼‰

### Outputï¼ˆè¾“å‡ºæ ¼å¼ï¼‰

```typescript
type FileProcessorOutput = 'text' | 'markdown'
```

### ProcessorTypeï¼ˆæœåŠ¡ç±»å‹ï¼‰

```typescript
type FileProcessorType = 'api' | 'builtin'
```

| ç±»å‹      | è¯´æ˜                                         |
| --------- | -------------------------------------------- |
| `api`     | API æœåŠ¡ï¼ˆéœ€è¦é…ç½® API Key/Hostï¼Œå«äº‘ç«¯å’Œè‡ªéƒ¨ç½²ï¼‰ |
| `builtin` | ç³»ç»Ÿå†…ç½®ï¼ˆåº”ç”¨å†…åµŒæˆ–ç³»ç»ŸåŸç”Ÿï¼Œæ— éœ€å¤–éƒ¨é…ç½®ï¼‰ |

---

## ç¤ºä¾‹æ•°æ®

### MinerUï¼ˆTemplateï¼‰

```typescript
{
  id: 'mineru',
  type: 'api',
  capabilities: [
    {
      feature: 'to_markdown',
      input: 'document',
      output: 'markdown',
      defaultApiHost: 'https://mineru.net'
    }
  ]
}
```

### Tesseractï¼ˆTemplateï¼‰

```typescript
{
  id: 'tesseract',
  type: 'builtin',
  capabilities: [
    { feature: 'text_extraction', input: 'image', output: 'text' }
  ]
}
```

### Mistralï¼ˆTemplateï¼‰

```typescript
{
  id: 'mistral',
  type: 'api',
  capabilities: [
    {
      feature: 'to_markdown',
      input: 'document',
      output: 'markdown',
      defaultApiHost: 'https://api.mistral.ai',
      defaultModelId: 'mistral-ocr-latest'
    }
  ]
}
```

### ç”¨æˆ·é…ç½®ç¤ºä¾‹ï¼ˆUserConfigï¼‰

```typescript
// ç”¨æˆ·ä¸º MinerU é…ç½®äº† API Key
{
  id: 'mineru',
  apiKey: '***'
}

// ç”¨æˆ·ä¸º PaddleOCR é…ç½®äº†ä¸åŒ feature çš„ API Host
{
  id: 'paddleocr',
  apiKey: '***',
  featureConfigs: [
    { feature: 'text_extraction', apiHost: 'https://my-paddleocr-server.com' }
  ]
}
```

### å¤„ç†å™¨å¯¹æ¯”è¡¨

| Processor     | type    | capabilities æ¦‚è¦                                      |
| ------------- | ------- | ------------------------------------------------------ |
| Tesseract     | builtin | text_extraction (image â†’ text)                         |
| System OCR    | builtin | text_extraction (image â†’ text)                         |
| PaddleOCR     | api     | text_extraction (image â†’ text)                         |
| Intel OV OCR  | builtin | text_extraction (image â†’ text)                         |
| MinerU        | api     | to_markdown (document â†’ markdown)                      |
| Doc2x         | api     | to_markdown (document â†’ markdown)                      |
| Mistral       | api     | to_markdown (document â†’ markdown)                      |
| Open MinerU   | api     | to_markdown (document â†’ markdown)                      |

### æœ¬è´¨åŒºåˆ«å¯¹æ¯”

| ç»´åº¦           | Tesseract              | Mistral                      | MinerU                     |
| -------------- | ---------------------- | ---------------------------- | -------------------------- |
| **æŠ€æœ¯åŸç†**   | ä¼ ç»Ÿ OCR å¼•æ“          | LLM å¤šæ¨¡æ€æ¨¡å‹               | ä¸“ä¸šæ–‡æ¡£è§£æå¼•æ“           |
| **æ ¸å¿ƒå®šä½**   | å›¾åƒæ–‡å­—è¯†åˆ«           | å›¾åƒ/æ–‡æ¡£ç†è§£ä¸æè¿°          | æ–‡æ¡£ç»“æ„ç²¾ç¡®è¿˜åŸ           |
| **è¾“å‡ºç‰¹ç‚¹**   | çº¯æ–‡æœ¬ï¼Œæ— ç»“æ„         | æ–‡æœ¬/Markdownï¼Œè¯­ä¹‰å®Œæ•´      | Markdownï¼Œç»“æ„ç²¾ç¡®ä¿ç•™     |
| **ç»“æ„ä¿ç•™**   | æ—                      | éƒ¨åˆ†ï¼ˆè¯­ä¹‰çº§ï¼‰               | å®Œæ•´ï¼ˆç‰ˆé¢çº§ï¼‰             |
| **è¡¨æ ¼å¤„ç†**   | ä¸æ”¯æŒ                 | æ”¯æŒï¼ˆå¯èƒ½æœ‰æŸå¤±ï¼‰           | ç²¾ç¡®è¿˜åŸ                   |
| **å…¬å¼å¤„ç†**   | ä¸æ”¯æŒ                 | æ”¯æŒï¼ˆå¯èƒ½æœ‰æŸå¤±ï¼‰           | ç²¾ç¡®è¿˜åŸï¼ˆLaTeXï¼‰          |
| **è¿è¡Œæ–¹å¼**   | å†…ç½®                   | API è°ƒç”¨                     | API è°ƒç”¨                   |
| **é€Ÿåº¦**       | å¿«                     | ä¸­ç­‰                         | è¾ƒæ…¢ï¼ˆç²¾ç¡®è§£æè€—æ—¶ï¼‰       |
| **é€‚ç”¨åœºæ™¯**   | ç®€å•å›¾ç‰‡æ–‡å­—æå–ã€ç¿»è¯‘ | èŠå¤©å›¾ç‰‡ç†è§£ã€å¿«é€Ÿæ–‡æ¡£æå–   | çŸ¥è¯†åº“ã€å­¦æœ¯è®ºæ–‡ã€æŠ€æœ¯æ–‡æ¡£ |

**æ€»ç»“**ï¼š

- **Tesseract**ï¼šè½»é‡å†…ç½®æ–¹æ¡ˆï¼Œåªåš"è¯†åˆ«æ–‡å­—"ï¼Œä¸ç†è§£å†…å®¹
- **Mistral**ï¼šLLM é©±åŠ¨ï¼Œèƒ½"ç†è§£å¹¶æè¿°"å†…å®¹ï¼Œä½†ç»“æ„è¿˜åŸéç²¾ç¡®
- **MinerU**ï¼šä¸“ä¸šæ–‡æ¡£è§£æï¼Œ"ä¸€æ¨¡ä¸€æ ·è¿˜åŸ"æ–‡æ¡£ç»“æ„ï¼Œä½†ä¸å…·å¤‡è¯­ä¹‰ç†è§£èƒ½åŠ›

---

## UI è®¾è®¡æ–¹æ¡ˆ

é‡‡ç”¨**åœºæ™¯ä¼˜å…ˆ + æ™ºèƒ½æ¨è**çš„è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®¾ç½® > æ–‡ä»¶å¤„ç†                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€ ğŸ“š çŸ¥è¯†åº“æ–‡æ¡£è§£æ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  å½“æ·»åŠ  PDF åˆ°çŸ¥è¯†åº“æ—¶ä½¿ç”¨                                   â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  é»˜è®¤æœåŠ¡: [MinerU                              â–¼]          â”‚â”‚
â”‚  â”‚            â”œâ”€ MinerU        ç²¾ç¡® Â· è¡¨æ ¼ Â· å…¬å¼ Â· æ¨è       â”‚â”‚
â”‚  â”‚            â”œâ”€ Doc2x         ç²¾ç¡® Â· è¡¨æ ¼ Â· å…¬å¼              â”‚â”‚
â”‚  â”‚            â”œâ”€ DeepSeek-OCR  æ™ºèƒ½ Â· å¿«é€Ÿ                     â”‚â”‚
â”‚  â”‚            â””â”€ ä¸ä½¿ç”¨é¢„å¤„ç†                                   â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€ ğŸ–¼ï¸ èŠå¤©å›¾ç‰‡ç†è§£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  å½“åœ¨å¯¹è¯ä¸­ä¸Šä¼ å›¾ç‰‡æ—¶ä½¿ç”¨                                    â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  é»˜è®¤æœåŠ¡: [DeepSeek-OCR                        â–¼]          â”‚â”‚
â”‚  â”‚            â”œâ”€ DeepSeek-OCR  å¤šæ¨¡æ€ Â· æè¿° Â· æ¨è            â”‚â”‚
â”‚  â”‚            â”œâ”€ Tesseract     çº¯æ–‡æœ¬ Â· æœ¬åœ°                   â”‚â”‚
â”‚  â”‚            â””â”€ ç³»ç»Ÿ OCR      çº¯æ–‡æœ¬ Â· æœ¬åœ°                   â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€ ğŸ”§ æœåŠ¡é…ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  å·²é…ç½® 3 ä¸ªæœåŠ¡ï¼Œç‚¹å‡»å±•å¼€é…ç½® API Key                       â”‚â”‚
â”‚  â”‚                                                     [å±•å¼€ â–¼]â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¸‹ä¸€æ­¥

1. å®Œå–„ TypeScript ç±»å‹å®šä¹‰
2. è®¾è®¡ç»Ÿä¸€æœåŠ¡æ¥å£ `FileProcessingService`
3. è¿ç§»ç°æœ‰ OCR å’Œ Preprocess å®ç°
4. å®ç° UI è®¾ç½®é¡µé¢
