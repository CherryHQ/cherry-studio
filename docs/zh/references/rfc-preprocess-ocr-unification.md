# RFC: OCR 与 Preprocess 统一与服务化（概念与边界）

本文为概念与边界阶段的 RFC 草案，面向团队内部（研发与产品）。重点聚焦“为何合并”和“服务化边界”，不涉及具体实现与迁移细节。

## 背景

当前系统中 OCR 与 Preprocess 分别服务不同场景：

- OCR：以“图片文字识别”为主，提供多种引擎能力，更多聚焦通用图像 OCR。
- Preprocess：以“知识库文档预处理”为主，主要处理 PDF（含扫描件），并将结果转化为可检索的文本/Markdown。

随着功能演进，Preprocess 可能依赖 OCR 技术提取内容，且两者都属于“对文件进行内容提取与解析”的范畴，存在能力重叠与边界模糊。

## 问题陈述

1. 概念重叠：OCR 与 Preprocess 都在“处理文件并提取文本”，职责划分不清晰，认知成本高。
2. 架构割裂：Preprocess 与知识库流程紧耦合，难以复用到其他业务（如文件上传、笔记、搜索等）。
3. 服务难复用：目前 Preprocess 更像“知识库内部步骤”，并非通用服务，无法成为平台能力。

## 目标

1. 统一 OCR 与 Preprocess 的概念边界，形成“文件处理能力”的统一表达与能力层。
2. 将 Preprocess 从知识库业务中抽离，成为可被各业务调用的服务。
3. 为未来扩展（多业务复用、更多文件类型、更多处理能力）建立清晰边界。

## 非目标

- 本 RFC 不定义具体实现细节与迁移步骤。
- 本 RFC 不确定具体供应商/引擎选择策略。
- 本 RFC 不讨论 UI 交互重构细节。

## 核心概念与术语（草案）

- 文件处理（File Processing）：
  对输入文件进行解析、内容提取、格式转换或结构化输出的能力集合。

- OCR（Optical Character Recognition）：
  将图像或扫描文件中的文本识别并输出为文本的能力。

- Preprocess（文档预处理）：
  对文档进行内容提取与结构化处理（可包含 OCR），输出可下游使用的文本/Markdown/结构化数据。

- 处理结果（Processing Result）：
  标准化输出，包括文本、Markdown、结构化块、附属资源（如图片切片）与元数据。

- 处理能力维度（Capability）：
  描述一个 provider 支持的文件类型、输出类型、以及是否具备 OCR、版面分析、表格识别等能力。

## 业务边界与责任划分

建议的边界划分：

1. 统一“文件处理服务”（File Processing Service）
   - 作为平台能力，对所有业务开放。
   - 接受文件与处理策略，输出标准化结果。
   - 内部可组合 OCR 与 Preprocess 能力。

2. 业务方（如知识库）
   - 负责业务流程与数据生命周期。
   - 调用统一服务获取处理结果，并决定后续使用方式（如入库、向量化等）。
   - 不直接绑定具体 OCR/Preprocess 实现。

## 方案概述（概念级）

### 统一能力层

将 OCR 与 Preprocess 统一为“文件处理能力”，以“能力维度”描述 provider，而不是以 OCR/Preprocess 的业务名区分。
例如：

- 能力：`text_extraction`, `layout_analysis`, `table_detection`, `image_ocr`
- 输入类型：`pdf`, `image`, `docx`
- 输出类型：`text`, `markdown`, `structured_blocks`

### 服务化

将 Preprocess 作为一个可调用的服务层：

- 统一入口：`process(file, options)`
- 统一输出：`ProcessingResult`
- 统一监控与配额策略

业务侧仅关心“输入/输出/策略”，不关心 provider 细节。

## 影响范围（概念级）

- 产品：概念统一后，相关设置与说明可简化为“文件处理能力”，降低理解成本。
- 研发：需要调整边界认知与调用方式，为后续模块拆分与服务化做准备。
- 运维/成本：统一入口有利于集中监控、计量与配额控制，但也可能引入更复杂的服务管理需求。

## 风险与开放问题

1. 统一概念后，UI 与文档如何表达，避免用户混淆？
2. 现有 provider 的能力差异如何映射到统一能力模型？
3. 业务方对处理结果的差异化需求如何满足（例如知识库与其他业务）？

## 下一步

1. 在此概念边界基础上，补充模块拆分与接口草案。
2. 明确统一服务的输出标准与能力模型。
3. 评估迁移路径与增量演进方案。
