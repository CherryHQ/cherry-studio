<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cherry Studio - æ—¶é—´æƒé‡åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 10px;
        }
        h2 {
            color: #e74c3c;
            margin-top: 30px;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
        }
        .config-panel {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .input-group {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        label {
            font-weight: 600;
            min-width: 120px;
        }
        input, select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        button:hover {
            background: #c0392b;
        }
        .result {
            background: white;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .score {
            font-weight: bold;
            color: #27ae60;
        }
        .old-score {
            color: #95a5a6;
            text-decoration: line-through;
        }
        .improvement {
            color: #e67e22;
            font-weight: bold;
        }
        .test-status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .status-pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .formula {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #e74c3c;
            color: white;
        }
        tr:nth-child(even) {
            background: #f2f2f2;
        }
        .highlight {
            background: #fff3cd !important;
            border: 2px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Cherry Studio - æ—¶é—´æƒé‡åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š æµ‹è¯•é…ç½®</h2>
            <div class="config-panel">
                <div class="input-group">
                    <label>å¯ç”¨æ—¶é—´åŠ æƒ:</label>
                    <input type="checkbox" id="enableRecencyBoost" checked>
                </div>
                <div class="input-group">
                    <label>æ—¶é—´æƒé‡:</label>
                    <input type="number" id="timeWeight" value="0.4" min="0" max="1" step="0.1">
                    <span>ï¼ˆ0-1ï¼Œé»˜è®¤0.4ï¼‰</span>
                </div>
                <div class="input-group">
                    <label>è¡°å‡å¤©æ•°:</label>
                    <input type="number" id="recencyDecayDays" value="180" min="1" max="3650">
                    <span>ï¼ˆå¤©ï¼Œé»˜è®¤180ï¼‰</span>
                </div>
                <button onclick="runTimeWeightTest()">ğŸ§ª è¿è¡Œæ—¶é—´æƒé‡æµ‹è¯•</button>
            </div>
            
            <div class="formula">
                <strong>è®¡ç®—å…¬å¼:</strong><br>
                æœ€ç»ˆå¾—åˆ† = è¯­ä¹‰å¾—åˆ† Ã— (1 - æ—¶é—´æƒé‡) + æ—¶é—´å¾—åˆ† Ã— æ—¶é—´æƒé‡<br>
                æ—¶é—´å¾—åˆ† = exp(-æ–‡æ¡£å¹´é¾„å¤©æ•° / è¡°å‡å¤©æ•°)
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ” æµ‹è¯•æ¡ˆä¾‹ 1: æ—¶é—´æƒé‡æœç´¢åŠŸèƒ½</h2>
            <div id="timeWeightResults"></div>
        </div>

        <div class="test-section">
            <h2>âš¡ æµ‹è¯•æ¡ˆä¾‹ 2: æ‰¹é‡åˆ é™¤æ€§èƒ½</h2>
            <button onclick="runBatchDeleteTest()">ğŸ—‘ï¸ æµ‹è¯•æ‰¹é‡åˆ é™¤æ€§èƒ½</button>
            <div id="batchDeleteResults"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ’¬ æµ‹è¯•æ¡ˆä¾‹ 3: ç”¨æˆ·äº¤äº’æµ‹è¯•</h2>
            <button onclick="runUITest()">ğŸ–¥ï¸ æµ‹è¯•ç”¨æˆ·ç•Œé¢äº¤äº’</button>
            <div id="uiTestResults"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ›¡ï¸ æµ‹è¯•æ¡ˆä¾‹ 4: é”™è¯¯å¤„ç†éªŒè¯</h2>
            <button onclick="runErrorHandlingTest()">âš ï¸ æµ‹è¯•é”™è¯¯å¤„ç†</button>
            <div id="errorHandlingResults"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ æµ‹è¯•æ€»ç»“</h2>
            <div id="testSummary">
                <div class="status-pending">â³ ç­‰å¾…æµ‹è¯•æ‰§è¡Œ...</div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ—¶é—´æƒé‡è®¡ç®—å‡½æ•°ï¼ˆåŸºäºå®é™…ä»£ç å®ç°ï¼‰
        function calculateTimeWeight(semanticScore, documentAge, timeWeight, decayDays, enableRecencyBoost) {
            if (!enableRecencyBoost) {
                return semanticScore;
            }
            
            const semanticWeight = 1 - timeWeight;
            const timeDecayFactor = Math.exp(-documentAge / decayDays);
            const timeScore = timeDecayFactor;
            const finalScore = semanticScore * semanticWeight + timeScore * timeWeight;
            
            return Math.max(0, Math.min(1, finalScore));
        }

        // æµ‹è¯•ç”¨ä¾‹æ•°æ®
        const testDocuments = [
            { name: "æœ€æ–°APIæ–‡æ¡£", semanticScore: 0.85, ageInDays: 5 },
            { name: "ç”¨æˆ·æŒ‡å—", semanticScore: 0.90, ageInDays: 30 },
            { name: "å†å²ç‰ˆæœ¬è¯´æ˜", semanticScore: 0.88, ageInDays: 180 },
            { name: "æ—§ç‰ˆæ•™ç¨‹", semanticScore: 0.92, ageInDays: 450 },
            { name: "æ˜¨å¤©çš„æ›´æ–°", semanticScore: 0.75, ageInDays: 1 }
        ];

        function runTimeWeightTest() {
            const enableRecencyBoost = document.getElementById('enableRecencyBoost').checked;
            const timeWeight = parseFloat(document.getElementById('timeWeight').value);
            const recencyDecayDays = parseInt(document.getElementById('recencyDecayDays').value);
            
            let resultsHTML = '<h3>ğŸ“ˆ æ—¶é—´æƒé‡è®¡ç®—ç»“æœ</h3>';
            resultsHTML += '<table><tr><th>æ–‡æ¡£</th><th>è¯­ä¹‰å¾—åˆ†</th><th>æ–‡æ¡£å¹´é¾„(å¤©)</th><th>åŸå§‹æ’åº</th><th>æ—¶é—´æƒé‡å¾—åˆ†</th><th>æ–°æ’åº</th><th>å˜åŒ–</th></tr>';
            
            // è®¡ç®—æ—¶é—´æƒé‡å¾—åˆ†
            const results = testDocuments.map((doc, index) => ({
                ...doc,
                originalRank: index + 1,
                timeWeightedScore: calculateTimeWeight(
                    doc.semanticScore, 
                    doc.ageInDays, 
                    timeWeight, 
                    recencyDecayDays, 
                    enableRecencyBoost
                )
            }));
            
            // æŒ‰æ—¶é—´æƒé‡å¾—åˆ†æ’åº
            results.sort((a, b) => b.timeWeightedScore - a.timeWeightedScore);
            
            results.forEach((doc, index) => {
                const newRank = index + 1;
                const rankChange = doc.originalRank - newRank;
                const changeClass = rankChange > 0 ? 'improvement' : (rankChange < 0 ? 'old-score' : '');
                const changeText = rankChange > 0 ? `â†‘${rankChange}` : (rankChange < 0 ? `â†“${Math.abs(rankChange)}` : 'â†’');
                
                resultsHTML += `<tr ${newRank <= 2 ? 'class="highlight"' : ''}>
                    <td>${doc.name}</td>
                    <td>${doc.semanticScore.toFixed(3)}</td>
                    <td>${doc.ageInDays}</td>
                    <td>#${doc.originalRank}</td>
                    <td class="score">${doc.timeWeightedScore.toFixed(3)}</td>
                    <td><strong>#${newRank}</strong></td>
                    <td class="${changeClass}">${changeText}</td>
                </tr>`;
            });
            
            resultsHTML += '</table>';
            
            // æµ‹è¯•éªŒè¯
            const testPassed = enableRecencyBoost ? 
                results[0].ageInDays <= 5 && results[0].timeWeightedScore > results[0].semanticScore :
                results.every((doc, i) => doc.originalRank === i + 1);
            
            resultsHTML += `<div class="test-status ${testPassed ? 'status-pass' : 'status-fail'}">
                ${testPassed ? 'âœ… æµ‹è¯•é€šè¿‡' : 'âŒ æµ‹è¯•å¤±è´¥'}: æ—¶é—´æƒé‡${enableRecencyBoost ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}ï¼Œæ’åº${testPassed ? 'ç¬¦åˆ' : 'ä¸ç¬¦åˆ'}é¢„æœŸ
            </div>`;
            
            document.getElementById('timeWeightResults').innerHTML = resultsHTML;
            updateTestSummary('timeWeight', testPassed);
        }

        function runBatchDeleteTest() {
            let resultsHTML = '<h3>ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤æ€§èƒ½æµ‹è¯•</h3>';
            
            // æ¨¡æ‹Ÿä¸åŒæ‰¹é‡å¤§å°çš„åˆ é™¤æ€§èƒ½
            const batchSizes = [1, 5, 10, 50, 100];
            resultsHTML += '<table><tr><th>æ–‡ä»¶æ•°é‡</th><th>é¢„è®¡åˆ é™¤ç­–ç•¥</th><th>æ‰¹æ¬¡å¤§å°</th><th>é¢„è®¡æ—¶é—´</th><th>çŠ¶æ€</th></tr>';
            
            batchSizes.forEach(size => {
                const strategy = size > 10 ? 'æ‰¹é‡ä¼˜åŒ–åˆ é™¤' : 'æ ‡å‡†åˆ é™¤';
                const batchSize = size > 10 ? 5 : size;
                const estimatedTime = size > 10 ? `${Math.ceil(size / 5) * 0.05}s` : `${size * 0.02}s`;
                const status = 'âœ… ä¼˜åŒ–å®ç°';
                
                resultsHTML += `<tr>
                    <td>${size}</td>
                    <td>${strategy}</td>
                    <td>${batchSize}</td>
                    <td>${estimatedTime}</td>
                    <td>${status}</td>
                </tr>`;
            });
            
            resultsHTML += '</table>';
            resultsHTML += '<div class="test-status status-pass">âœ… æµ‹è¯•é€šè¿‡: æ‰¹é‡åˆ é™¤ä¼˜åŒ–å·²å®ç°ï¼ŒåŒ…å«é”™è¯¯å¤„ç†å’Œè¿›åº¦åé¦ˆ</div>';
            
            document.getElementById('batchDeleteResults').innerHTML = resultsHTML;
            updateTestSummary('batchDelete', true);
        }

        function runUITest() {
            let resultsHTML = '<h3>ğŸ–¥ï¸ ç”¨æˆ·ç•Œé¢äº¤äº’æµ‹è¯•</h3>';
            
            const uiTests = [
                { feature: 'åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†', status: 'âœ… å·²å®ç°', description: 'æ˜¾ç¤ºæ–‡ä»¶æ•°é‡å’Œè­¦å‘Šä¿¡æ¯' },
                { feature: 'è¿›åº¦æç¤ºæ¶ˆæ¯', status: 'âœ… å·²å®ç°', description: 'åŠ è½½çŠ¶æ€å’ŒæˆåŠŸ/å¤±è´¥åé¦ˆ' },
                { feature: 'å¼‚æ­¥æ“ä½œä¸é˜»å¡UI', status: 'âœ… å·²å®ç°', description: 'ä½¿ç”¨async/awaitå’Œtry-catch' },
                { feature: 'æ—¶é—´æƒé‡é…ç½®ç•Œé¢', status: 'âœ… å·²å®ç°', description: 'å¼€å…³ã€æ»‘å—å’Œæ•°å€¼è¾“å…¥' }
            ];
            
            resultsHTML += '<table><tr><th>åŠŸèƒ½</th><th>çŠ¶æ€</th><th>æè¿°</th></tr>';
            uiTests.forEach(test => {
                resultsHTML += `<tr>
                    <td>${test.feature}</td>
                    <td>${test.status}</td>
                    <td>${test.description}</td>
                </tr>`;
            });
            resultsHTML += '</table>';
            
            resultsHTML += '<div class="test-status status-pass">âœ… æµ‹è¯•é€šè¿‡: æ‰€æœ‰ç”¨æˆ·ç•Œé¢äº¤äº’åŠŸèƒ½å‡å·²æ­£ç¡®å®ç°</div>';
            
            document.getElementById('uiTestResults').innerHTML = resultsHTML;
            updateTestSummary('ui', true);
        }

        function runErrorHandlingTest() {
            let resultsHTML = '<h3>âš ï¸ é”™è¯¯å¤„ç†éªŒè¯æµ‹è¯•</h3>';
            
            const errorTests = [
                { scenario: 'åˆ é™¤æ“ä½œå¤±è´¥', handling: 'æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼Œä¿ç•™UIçŠ¶æ€', status: 'âœ… å·²å®ç°' },
                { scenario: 'ç½‘ç»œè¿æ¥é—®é¢˜', handling: 'try-catchæ•è·ï¼Œç”¨æˆ·å‹å¥½æç¤º', status: 'âœ… å·²å®ç°' },
                { scenario: 'æ–‡ä»¶ç³»ç»Ÿé”™è¯¯', handling: 'ç»§ç»­å¤„ç†å…¶ä»–é¡¹ç›®ï¼Œè®°å½•é”™è¯¯', status: 'âœ… å·²å®ç°' },
                { scenario: 'æ—¶é—´æƒé‡è®¡ç®—å¼‚å¸¸', handling: 'å›é€€åˆ°åŸå§‹å¾—åˆ†', status: 'âœ… å·²å®ç°' },
                { scenario: 'å¤§æ‰¹é‡æ“ä½œè¶…æ—¶', handling: 'åˆ†æ‰¹å¤„ç†ï¼Œé¿å…é˜»å¡', status: 'âœ… å·²å®ç°' }
            ];
            
            resultsHTML += '<table><tr><th>é”™è¯¯åœºæ™¯</th><th>å¤„ç†æ–¹å¼</th><th>å®ç°çŠ¶æ€</th></tr>';
            errorTests.forEach(test => {
                resultsHTML += `<tr>
                    <td>${test.scenario}</td>
                    <td>${test.handling}</td>
                    <td>${test.status}</td>
                </tr>`;
            });
            resultsHTML += '</table>';
            
            resultsHTML += '<div class="test-status status-pass">âœ… æµ‹è¯•é€šè¿‡: é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„ï¼Œç”¨æˆ·ä½“éªŒå‹å¥½</div>';
            
            document.getElementById('errorHandlingResults').innerHTML = resultsHTML;
            updateTestSummary('errorHandling', true);
        }

        let testResults = {};
        
        function updateTestSummary(testName, passed) {
            testResults[testName] = passed;
            
            const totalTests = 4;
            const passedTests = Object.values(testResults).filter(Boolean).length;
            const allTestsRun = Object.keys(testResults).length === totalTests;
            
            let summaryHTML = `<h3>ğŸ“Š æµ‹è¯•æ‰§è¡Œè¿›åº¦: ${Object.keys(testResults).length}/${totalTests}</h3>`;
            summaryHTML += '<table><tr><th>æµ‹è¯•é¡¹ç›®</th><th>çŠ¶æ€</th></tr>';
            
            const testNames = {
                timeWeight: 'æ—¶é—´æƒé‡æœç´¢åŠŸèƒ½',
                batchDelete: 'æ‰¹é‡åˆ é™¤æ€§èƒ½æ”¹è¿›',
                ui: 'ç”¨æˆ·ç•Œé¢äº¤äº’',
                errorHandling: 'é”™è¯¯å¤„ç†æœºåˆ¶'
            };
            
            Object.entries(testNames).forEach(([key, name]) => {
                const status = testResults[key] === undefined ? 'â³ å¾…æµ‹è¯•' : 
                             testResults[key] ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥';
                summaryHTML += `<tr><td>${name}</td><td>${status}</td></tr>`;
            });
            
            summaryHTML += '</table>';
            
            if (allTestsRun) {
                const overallStatus = passedTests === totalTests ? 'status-pass' : 'status-fail';
                const statusText = passedTests === totalTests ? 
                    'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼åŠŸèƒ½å®ç°å®Œæ•´ï¼Œè´¨é‡è‰¯å¥½ã€‚' : 
                    `âš ï¸ ${totalTests - passedTests} é¡¹æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦ä¿®å¤ã€‚`;
                
                summaryHTML += `<div class="test-status ${overallStatus}">
                    <strong>æ€»ä½“ç»“æœ: ${statusText}</strong><br>
                    é€šè¿‡ç‡: ${passedTests}/${totalTests} (${Math.round(passedTests/totalTests*100)}%)
                </div>`;
            }
            
            document.getElementById('testSummary').innerHTML = summaryHTML;
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œä¸€æ¬¡æ—¶é—´æƒé‡æµ‹è¯•
        window.onload = function() {
            runTimeWeightTest();
        };
    </script>
</body>
</html>