name: Publish Docs Update on Release

on:
  release:
    types: [published, edited]

permissions:
  contents: write

jobs:
  dispatch-docs-update:
    runs-on: ubuntu-latest
    # 暂时移除这一行，以便 Job 总是运行，我们可以查看日志
    # if: github.event.release.make_latest

    steps:
      - name: Debug Release Event Context # 新增的调试步骤
        run: |
          echo "github.event.release.make_latest: ${{ github.event.release.make_latest }}"
          echo "github.event.action: ${{ github.event.action }}"
          echo "Full github.event.release object:"
          echo "${{ toJSON(github.event.release) }}" # 打印整个 release 对象

      - name: Get release tag
        id: get-tag
        shell: bash
        run: |
          echo "tag=${{ github.event.release.tag_name }}" >> $GITHUB_OUTPUT

      - name: Dispatch update-download-version workflow to cherry-studio-docs
        # 暂时修改此 if 条件，使其在调试阶段不跳过
        # 或者您可以直接删除此 if 条件，在调试成功后再添加回来
        if: true # 临时设置为 true，确保此步骤运行
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.REPO_DISPATCH_TOKEN }}
          repository: CherryHQ/cherry-studio-docs
          event-type: update-download-version
          client-payload: '{"version": "${{ steps.get-tag.outputs.tag }}"}'

