name: Dispatch Docs Update on Release

on:
  release:
    types: [released]

permissions:
  contents: write

jobs:
  dispatch-docs-update:
    runs-on: ubuntu-latest
    steps:
      - name: Get Release Tag from Event
        id: get-event-tag
        shell: bash
        run: |
          # 从当前 Release 事件中获取 tag_name
          echo "tag=${{ github.event.release.tag_name }}" >> $GITHUB_OUTPUT

      - name: Dispatch update-download-version workflow to cherry-studio-docs
        # 只有当当前事件的 Release 标签与通过 API 获取到的最新 Release 标签一致时，才发送调度事件
        if: ${{ steps.get-event-tag.outputs.tag == steps.get-latest-tag.outputs.latest_tag }}
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.REPO_DISPATCH_TOKEN }}
          repository: CherryHQ/cherry-studio-docs
          event-type: update-download-version
          client-payload: '{"version": "${{ steps.get-event-tag.outputs.tag }}"}'
